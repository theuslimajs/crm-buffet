// Configuração do motor do Prisma para gerar o cliente de banco de dados
generator client {
  provider = "prisma-client-js"
}

// Configuração da conexão com o Neon (PostgreSQL)
datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// --- 1. GESTÃO DE USUÁRIOS E PERMISSÕES ---
model Usuario {
  id                String   @id @default(uuid())
  nome              String
  email             String   @unique
  senha             String
  cargo             String   // Ex: DONO, GERENTE, VENDEDOR
  createdAt         DateTime @default(now())

  // Flags de permissão para controle de acesso no Layout
  podeVerLeads      Boolean  @default(false)
  podeVerCalendario Boolean  @default(false)
  podeVerFestas     Boolean  @default(false)
  podeVerTarefas    Boolean  @default(false)
  podeVerEstoque    Boolean  @default(false)
  podeVerFinanceiro Boolean  @default(false)
  podeVerRelatorios Boolean  @default(false)
}

// --- 2. COMERCIAL E CRM ---
model Lead {
  id         String    @id @default(uuid())
  nome       String
  telefone   String
  status     String    // NOVO, EM_NEGOCIACAO, FECHADO, PERDIDO
  origem     String?   // Ex: Instagram, Google, Indicação
  dataVisita DateTime?
  createdAt  DateTime  @default(now())
}

model Cliente {
  id        String   @id @default(uuid())
  nome      String
  telefone  String
  email     String?
  createdAt DateTime @default(now())
  festas    Festa[]  // Relacionamento um-para-muitos
}

// --- 3. OPERACIONAL (AGENDA E EVENTOS) ---
model Festa {
  id                 String   @id @default(uuid())
  nomeAniversariante String
  dataFesta          DateTime
  horaInicio         String   @default("19:00")
  horaFim            String   @default("23:00")
  valorTotal         Float
  qtdPessoas         Int
  status             String   // AGENDADO, REALIZADO, CANCELADO
  
  // Relacionamentos
  clienteId String
  cliente   Cliente @relation(fields: [clienteId], references: [id])
  
  pacoteId  String?
  pacote    Pacote? @relation(fields: [pacoteId], references: [id])

  pagamentos Pagamento[] 
  createdAt DateTime @default(now())
}

model Pacote {
  id          String  @id @default(uuid())
  nome        String  // Ex: "Pacote Ouro", "Festa Escolar"
  precoBase   Float
  descricao   String?
  festas      Festa[]
}

// --- 4. TAREFAS E EQUIPE ---
model Tarefa {
  id          String   @id @default(uuid())
  descricao   String
  equipe      String   // Cozinha, Garçons, Limpeza
  dataLimite  DateTime
  status      String   // PENDENTE, CONCLUIDA
  createdAt   DateTime @default(now())
}

// --- 5. LOGÍSTICA (ESTOQUE) ---
model ItemEstoque {
  id            String   @id @default(uuid())
  nome          String
  categoria     String   // Bebidas, Descartáveis, Alimentação
  quantidade    Int
  estoqueMinimo Int
  unidade       String   @default("UN") // UN, KG, L
  updatedAt     DateTime @updatedAt
}

// --- 6. FINANCEIRO (CAIXA) ---
model Pagamento {
  id             String   @id @default(uuid())
  valor          Float
  dataVencimento DateTime
  status         String   // PENDENTE, PAGO
  parcela        Int      // 0 para entrada, 1 para parcela 1, etc.
  metodo         String   // PIX, CARTÃO, DINHEIRO
  
  festaId        String?
  festa          Festa?   @relation(fields: [festaId], references: [id])
  
  createdAt      DateTime @default(now())
}

model Despesa {
  id             String   @id @default(uuid())
  descricao      String   // Ex: Conta de luz, Fornecedor
  valor          Float
  categoria      String
  dataVencimento DateTime
  status         String   // PENDENTE, PAGO
  createdAt      DateTime @default(now())
}

// --- 7. SIMULADOR DE LUCRO ---
model Simulacao {
  id              String   @id @default(uuid())
  festaId         String?
  receitaPrevista Float
  custoTotal      Float
  lucroEstimado   Float
  margem          Float
  detalhes        String   // Dados extras salvos como texto JSON
  createdAt       DateTime @default(now())
}