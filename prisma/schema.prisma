generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum CargoUsuario { DONO GERENTE VENDEDOR FREELANCER }
enum StatusLead { NOVO EM_NEGOCIACAO FECHADO PERDIDO }
enum StatusFesta { AGENDADO REALIZADO CANCELADO }
enum StatusTarefa { PENDENTE CONCLUIDA }
enum StatusPagamento { PENDENTE PAGO }
enum MetodoPagamento { PIX CARTAO DINHEIRO A_DEFINIR A_RECEBER }

model Usuario {
  id                String   @id @default(uuid())
  nome              String
  email             String   @unique
  senha             String
  cargo             CargoUsuario
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  podeVerLeads      Boolean  @default(false)
  podeVerCalendario Boolean  @default(false)
  podeVerFestas     Boolean  @default(false)
  podeVerTarefas    Boolean  @default(false)
  podeVerEstoque    Boolean  @default(false)
  podeVerFinanceiro Boolean  @default(false)
  podeVerRelatorios Boolean  @default(false)
}

model Lead {
  id         String    @id @default(uuid())
  nome       String
  telefone   String
  status     StatusLead
  origem     String?
  dataVisita DateTime?
  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @updatedAt
}

model Cliente {
  id        String   @id @default(uuid())
  nome      String
  telefone  String
  email     String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  festas    Festa[]
}

model Festa {
  id                 String   @id @default(uuid())
  nomeAniversariante String
  dataFesta          DateTime
  horaInicio         String   @default("19:00")
  horaFim            String   @default("23:00")
  valorTotal         Float
  qtdPessoas         Int
  status             StatusFesta

  clienteId String
  cliente   Cliente @relation(fields: [clienteId], references: [id], onDelete: Restrict)

  pacoteId  String
  pacote    Pacote  @relation(fields: [pacoteId], references: [id], onDelete: Restrict)

  pagamentos Pagamento[]
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
}

model Pacote {
  id        String  @id @default(uuid())
  nome      String
  precoBase Float
  descricao String?
  festas    Festa[]
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Tarefa {
  id         String      @id @default(uuid())
  descricao  String
  equipe     String
  dataLimite DateTime
  status     StatusTarefa
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
}

model ItemEstoque {
  id            String   @id @default(uuid())
  nome          String
  categoria     String
  quantidade    Int
  estoqueMinimo Int
  unidade       String   @default("UN")
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

model Pagamento {
  id             String         @id @default(uuid())
  valor          Float
  dataVencimento DateTime
  status         StatusPagamento
  parcela        Int
  metodo         MetodoPagamento

  festaId        String?
  festa          Festa? @relation(fields: [festaId], references: [id], onDelete: Cascade)

  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  @@index([dataVencimento])
  @@index([status])
  @@index([festaId])
}

model Despesa {
  id             String   @id @default(uuid())
  descricao      String
  valor          Float
  categoria      String
  dataVencimento DateTime
  status         StatusPagamento
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  @@index([dataVencimento])
  @@index([status])
}

model Simulacao {
  id              String   @id @default(uuid())
  festaId         String?
  festa           Festa?   @relation(fields: [festaId], references: [id], onDelete: SetNull)

  receitaPrevista Float
  custoTotal      Float
  lucroEstimado   Float
  margem          Float
  detalhes        String
  createdAt       DateTime @default(now())

  @@index([createdAt])
}
